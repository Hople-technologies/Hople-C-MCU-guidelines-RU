# Типы библиотек

При разработке программного обеспечения для микроконтроллеров мы выделяем 3 вида библиотек:
* библиотеки реализации (implementation);
* библиотеки не зависящие от реализации (implementation independent);
* чистые библиотеки (pure).

Перед тем, как объяснить, зачем необходим каждый тип библиотек, нужно понять ситуации, возникающую при разработке программного обеспечения для микроконтроллеров:
* внутри современных микроконтроллеров находится большое количество периферии, соответственно каждая отдельная ножка может быть отнесена к большому количеству различных периферийных устройств;
* настройка этих периферийных устройств может сильно отличаться как между различными производителями микроконтроллеров, так и между различными семействами одного типа микроконтроллера;
* после добавления микроконтроллера на печатную плату, задачи всех ножек уже известны и не будут изменяться в процессе работы устройства;

Программирование микроконтроллеров начинается с настройки и реализации взаимодействия с периферией (например считывание показаний АЦП, передачи данных по интерфейсам связи или генерации ШИМ-сигнала). Код реализующий непосредственную настройку, а также взаимодействие с периферией можно назвать "программным обеспечением уровня железа", важной особенностью этого совершенно условного типа программного обеспечения является то, что оно будет отличаться для различных семейств микроконтроллеров, и даже для одинаковых микроконтроллеров, установленных в различные устройства (так как требуемый от МК функционал может отличаться). 

На следующем "уровне" программного обеспечения реализуется логика обработки данных, полученных от периферии (например различные преобразования: показаний АЦП в определенный физический параметр или данный полученных от IMU в углы или скорости изменения углов). Важной особенность кода на этом уровне является то, что он полностью не зависит от конкретной реализации взаимодействия с периферией, но  опирается на это взаимодействие (Например алгоритму вычисления значения физического параметра нет разницы, каким именно образом были получены данные из АЦП, а вот что имеет значения, так это разрядность АЦП и интервал времени между измерениями, но при этом данный алгоритм может работать только в паре с настроенным под конкретные параметры АЦП и не имеет никакого смысла в полностью оторванном от железа состоянии). Данный код можно назвать *зависящим от периферии, но не зависящим от реализации*, так как она опирается на наличие и параметры определенной периферии, но не зависит от конкретных способов взаимодействия с этой периферией.

На "самом высоком уровне" находится программное обеспечение, полностью независящее от конкретного железа, на котором запускается. В основном это код для различного рода вычислений (например вычисления положение объекта в пространстве по углам, с IMU или использование вычисленных физических параметров для проведения моделирования какого-либо вида) или общей логики работы программы (операционные системы реального времени, конечные автоматы и так далее).

Все три описанных выше типа являются условными и не имеют строгих границ, однако что важно, практически любое программное обеспечение под микроконтроллеры можно разделить между этими типами. Библиотеки, реализующие методы "высокого уровня" мы будем называть **чистыми (pure libraries)**. Библиотеки опирающиеся на периферию, но не зависящие от реализации взаимодействия с это периферией мы будем называть **не зависящими от реализации(implementation independent libraries)**. Библиотеки, реализующие настройку и взаимодействие с периферией мы будем называть **библиотеками реализации (implementation libraries)**.

**Чистые** библиотеки по определению являются унифицированными и могут быть использованы на любых видах микроконтроллеров любых производителей, и вообще при разработке любого вида программного обеспечения. Разделение библиотек на implementation и implementation independent, позволяет разрабатывать унифицированное программное обеспечение с возможностью запуска на любых устройствах, имеющих в наличии необходимую для запуска кода периферию.

Для обеспечения унификации implementation independent-библиотеки (далее inimp-библиотеки) должны выдвигать требования к implementation-библиотекам (далее imp-библиотеки) по реализации конкретного интерфейса обмена данными: то есть набора функций, возвращающих конкретные значения от конкретной периферии. В свою очередь imp-библиотеки должны предоставлять необходимые функции взаимодействия с периферией конкретного микроконтроллера. Например inimp-библиотека взаимодействия с микросхемой гироскопа/акселерометра должна требовать от Implementation библиотеки конкретной настройки параметров интерфейса SPI (частоты передачи, данных, вида сообщения и так далее), а также предоставления функции, которая бы позволяла отправлять байт по интерфейсу SPI и возвращала бы байт, полученный этим интерфейсом. При этом Implementation библиотеки совершенно не важно, к акому именно SPI на микроконтроллере будет подключена микросхема. Со своей стороны imp-библиотека должна настроить SPI к которому подключена микросхема передачи данных на требуемые параметры и предоставить функцию соответствующую требованиям inimp-библиотеки для данного конкретного SPI, после чего inimp-библиотека может воспользоваться указателем на данную функцию для реализации логики обмена данными.

Это очень простой пример того, как можно разделить зоны ответственности между различными библиотеками, написанная один раз inimp-библиотека может свободно переноситься между любыми устройствами при условии, что для них будет написана imp-библиотека. Под imp-библиотекой мы подразумеваем чуть больше чем реализацию конкретных функций для конкретного микроконтроллера, подробнее об этом можно почитать в подглаве, описывающей нашу архитектуру imp-библиотек. Для При этом imp-библиотека это в целом очень опциональная вещь, которая в современной ситуации может быть реализована производителем микроконтроллеров в том или ином виде. Например STMicroelectronics предоставляет приложение CubeMX, с помощью которого можно интерактивно настроить ножки и параметры периферии, а также библиотеку HAL, которая реализует большое количество функций взаимодействия с периферией (например ту же функцию передачи одного байта по заданному SPI с возвращением полученного байта), что может значительно ускорить разработку при условии наличия готовой inimp-библиотеки.

Это было очень высокоуровневое описание нашей идеи разделения программного обеспечения для микроконтроллеров на типы. Подробнее о том, в каком именно виде мы представляем каждый тип библиотек написано в соответствующих подглавах.

**Нашей основной целью является продвижение идеи inimp-библиотек и станадртизация их оформления** для обеспечения более унифицированного взаимодействия между различными устройствами., как так как библиотеки, реализующие работу с периферией часто предоставляются компаниями-производителями микросхем, а чистые библиотеки не имеют никаких принципиальных проблемы для чего мы предлагаем правила оформления кода, выдвижения и описания требований,


(В это описание надо со временем привести побольше примеров с кодом и пару картинок, разъясняющих ситуацию)
Сейчас еще задумался о том, что impi-библиотеки это именно библиотеки взаимодействия с какого-то рода конкретными устройствами (микросхемами или каскадами) и возможно есть смысл ввести еще четвертый тип библиотек, схожих по наполнению с impi, но необходимых для реализации логики работы какого-то конкретного устройства - что-то, что я когда-то называл device-библиотеками, но это надо смотреть на практике

**Важно еще написать что вообще подразумевается под библиотекой (мол это не один .h-файл, а их набор, главный из которых имеет в названии нужный постфикс)**