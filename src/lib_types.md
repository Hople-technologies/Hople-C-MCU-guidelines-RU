# Типы библиотек

При разработке программного обеспечения для микроконтроллеров мы выделяем 3 типа библиотек по признак зависимости от аппаратного обеспечения (hardware dependency differentiation HDD):
* взаимодействия с аппаратным обеспечением (hardware interfacing);
* зависящие от аппаратного обеспечения, но не зависящие от взаимодействия (hardware dependent, interfacing independent);
* не зависящие от аппаратного обеспечения (hardware independent).

Перед тем, как объяснить, зачем необходим каждый тип библиотек, нужно понять ситуации, возникающую при разработке программного обеспечения для микроконтроллеров:
* внутри современных микроконтроллеров находится большое количество периферии, соответственно каждый вывод может быть отнесен к большому количеству различных периферийных устройств;
* настройка идентичных периферий может сильно отличаться как между различными производителями, так и между различными семействами микроконтроллеров одного производителя;
* после добавления микроконтроллера на печатную плату, задачи всех ножек уже известны и не будут изменяться в процессе работы устройства.

Программирование микроконтроллеров начинается с настройки и реализации взаимодействия с периферией (например считывание показаний АЦП, передачи данных по интерфейсам связи или генерации ШИМ-сигнала). Код реализующий непосредственную настройку, а также взаимодействие с периферией можно назвать "**программным обеспечением взаимодействия с аппаратным обеспечением**", важной особенностью этого совершенно условного типа ПО является то, что оно будет отличаться как для различных семейств микроконтроллеров установленных в идентичные устройства, так и для одинаковых микроконтроллеров, установленных в различные устройства (так как требуемый от МК функционал может отличаться). 

На следующем "уровне" программного обеспечения реализуется логика обработки данных, полученных от периферии (например различные преобразования: показаний АЦП в определенный физический параметр или данных полученных от IMU в углы или скорости изменения углов). Данный тип программного обеспечения мы будем называть "**зависящим от аппаратного обеспечения, но не зависящими от взаимодействия** с аппаратным обеспечением. Важной особенность данного типа ПО является независимость от конкретных методов взаимодействия с периферией микроконтроллера, но прим этом зависимость от конкретного типа периферии. Для объяснения этого утверждения объясним пример про обработку показаний АЦП: для вычисления значения физического параметр не важно, каким именно образом было получено значение от конкретного АЦП, с другой стороны значение имеет конкретный вид схемы измерения, разрядность АЦП и период опроса. Все важные параметры в этом примере известны заранее и не изменяются в ходе работы устройства.

Большое количество программного обеспечения вообще не использует какую-либо периферию цифровых устройств на которых запускается. Пара примеров: алгоритмы вычисления положения объекта в пространстве по углам, полученным от различных датчиков (гироскоп, акселерометр, компас) - данные от датчиков получаются уже в физических величинах, и соответственно никакого взаимодействия с железом не происходит, такой алгоритм может использоваться как в системах управления беспилотными летательными аппаратами, так и для моделирования таких систем без каких либо изменений. К другим примером можно отнести алгоритмы кодирования и декодирования, работу с двухмерной графикой для последующего отображения на дисплеях и  многое другое. Программное обеспечение данного типа мы будем называть "не зависящим от аппаратного обеспечения".

Описанные выше типы являются условными и не имеют строгих границ, однако практически любое программное обеспечение для микроконтроллеров можно разделить между этими тремя типами. Для каждого описанного типа ПО возможно реализация независимых библиотек. Мы будем называть эти библиотеки в соответствии с типами ПО, которые данные библиотеки реализуют реализуют: библиотеки **независящими от аппаратного обеспечения (hardware independent libraries)**, библиотеки **зависящие от аппаратного обеспечения, но не зависящие от взаимодействия (hardware dependent, interfacing independent) - далее hwdii-библиотеки**, библиотеки **взаимодействия с аппаратным обеспечением (hardware interfacing), далее hwi-библиотеки**.

Для упрощения классификации введем три правила:
* если в библиотеке есть хотя бы одна функция, реализующая настройку или взаимодействие с каким-либо видом микроконтроллеров, данная библиотека называться hwi вне зависимости от объема и остального содержания;
* если в библиотеке есть хотя бы одна функция, реализующая обработку данных от конкретной периферии, но нет функций настройки и взаимодействия с периферией, данная библиотека относится к типу hwdii;
* если в библиотеке нет никаких зависимостей от периферии (будь то настройка, взаимодействие или обработка), библиотека будет независящей от аппаратного обеспечения.

**Мы не беремся каким-либо образом классифицировать и стандартизировать эти библиотеки** К **независящим от аппаратного обеспечения** относятся все библиотеки общего назначения. .




**Чистые** библиотеки по определению являются унифицированными и могут быть использованы на любых видах микроконтроллеров любых производителей, и вообще при разработке любого вида программного обеспечения. Разделение библиотек на implementation и implementation independent, позволяет разрабатывать унифицированное программное обеспечение с возможностью запуска на любых устройствах, имеющих в наличии необходимую для запуска кода периферию.

Для обеспечения унификации implementation independent-библиотеки (далее inimp-библиотеки) должны выдвигать требования к implementation-библиотекам (далее imp-библиотеки) по реализации конкретного интерфейса обмена данными: то есть набора функций, возвращающих конкретные значения от конкретной периферии. В свою очередь imp-библиотеки должны предоставлять необходимые функции взаимодействия с периферией конкретного микроконтроллера. Например inimp-библиотека взаимодействия с микросхемой гироскопа/акселерометра должна требовать от Implementation библиотеки конкретной настройки параметров интерфейса SPI (частоты передачи, данных, вида сообщения и так далее), а также предоставления функции, которая бы позволяла отправлять байт по интерфейсу SPI и возвращала бы байт, полученный этим интерфейсом. При этом Implementation библиотеки совершенно не важно, к акому именно SPI на микроконтроллере будет подключена микросхема. Со своей стороны imp-библиотека должна настроить SPI к которому подключена микросхема передачи данных на требуемые параметры и предоставить функцию соответствующую требованиям inimp-библиотеки для данного конкретного SPI, после чего inimp-библиотека может воспользоваться указателем на данную функцию для реализации логики обмена данными.

Это очень простой пример того, как можно разделить зоны ответственности между различными библиотеками, написанная один раз inimp-библиотека может свободно переноситься между любыми устройствами при условии, что для них будет написана imp-библиотека. Под imp-библиотекой мы подразумеваем чуть больше чем реализацию конкретных функций для конкретного микроконтроллера, подробнее об этом можно почитать в подглаве, описывающей нашу архитектуру imp-библиотек. Для При этом imp-библиотека это в целом очень опциональная вещь, которая в современной ситуации может быть реализована производителем микроконтроллеров в том или ином виде. Например STMicroelectronics предоставляет приложение CubeMX, с помощью которого можно интерактивно настроить ножки и параметры периферии, а также библиотеку HAL, которая реализует большое количество функций взаимодействия с периферией (например ту же функцию передачи одного байта по заданному SPI с возвращением полученного байта), что может значительно ускорить разработку при условии наличия готовой inimp-библиотеки.

Это было очень высокоуровневое описание нашей идеи разделения программного обеспечения для микроконтроллеров на типы. Подробнее о том, в каком именно виде мы представляем каждый тип библиотек написано в соответствующих подглавах.

**Нашей основной целью является продвижение идеи inimp-библиотек и станадртизация их оформления** для обеспечения более унифицированного взаимодействия между различными устройствами., как так как библиотеки, реализующие работу с периферией часто предоставляются компаниями-производителями микросхем, а чистые библиотеки не имеют никаких принципиальных проблемы для чего мы предлагаем правила оформления кода, выдвижения и описания требований,


## Что дает использование inti



(В это описание надо со временем привести побольше примеров с кодом и пару картинок, разъясняющих ситуацию)
Сейчас еще задумался о том, что impi-библиотеки это именно библиотеки взаимодействия с какого-то рода конкретными устройствами (микросхемами или каскадами) и возможно есть смысл ввести еще четвертый тип библиотек, схожих по наполнению с impi, но необходимых для реализации логики работы какого-то конкретного устройства - что-то, что я когда-то называл device-библиотеками, но это надо смотреть на практике

**Важно еще написать что вообще подразумевается под библиотекой (мол это не один .h-файл, а их набор, главный из которых имеет в названии нужный постфикс)**